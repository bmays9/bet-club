{% extends "base.html" %}

{% block content %}
<h1>LMS History</h1>

<!-- Group selector -->
<form method="get" action="{% url 'lms_history' %}">
    <select name="group" onchange="this.form.submit()">
        {% for group in groups %}
            <option value="{{ group.id }}" {% if group == selected_group %}selected{% endif %}>
                {{ group.name }}
            </option>
        {% endfor %}
    </select>
</form>

<hr>

{% if games %}
    <table border="1" cellpadding="5" class="table table-hover">
        <thead>
            <tr class="table-primary">
                <th scope="col">Started</th>
                <th scope="col">League</th>
                <th scope="col">Players</th>
                <th scope="col">Entry Fee</th>
                <th scope="col">Winner</th>
                <th scope="col">Prize</th>
                <th scope="col">View</th>
            </tr>
        </thead>
        <tbody>
            {% for game in games %}
                <tr scope="row">
                    <!-- created_at from LMSGame -->
                    <td>{{ game.game.created_at|date:"M d, Y" }}</td>

                    <!-- league with display name -->
                    <td>{{ game.game.get_league_display }}</td>

                    <!-- annotated player_count -->
                    <td>{{ game.player_count }}</td>

                    <!-- entry fee -->
                    <td>£{{ game.game.entry_fee }}</td>

                    <!-- single winner -->
                    <td>
                        {% if game.game.winner %}
                            {{ game.game.winner.username }}
                        {% else %}
                            No winner
                        {% endif %}
                    </td>

                    <!-- prize pot (calculated in view) -->
                    <td>£{{ game.prize_pot }}</td>

                    <!-- link to detail page (only if game has id) -->
                    <td>
                        {% if game.game.id %}
                            <a href="{% url 'lms_game_detail' game.game.id %}" class="btn btn-sm btn-primary">
                                View Game
                            </a>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No completed LMS games for this group.</p>
{% endif %}


{% endblock %}
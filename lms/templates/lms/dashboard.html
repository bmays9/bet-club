{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Your LMS Games</h2>

<!-- Joined Games -->
{% if entries_with_rounds %}
  <h3>Games You Have Joined</h3>
  <ul class="list-group mb-4">
    {% for item in entries_with_rounds %}
      <li class="list-group-item">
        <strong>{{ item.entry.game.get_league_display }}</strong> 
        — Round {% if item.next_round %}{{ item.next_round.round_number }}{% else %}N/A{% endif %}
        {% if item.next_round %}
          ({{ item.next_round.start_date|date:"M d, Y H:i" }} – {{ item.next_round.end_date|date:"M d, Y H:i" }})
        {% endif %}

        {% if item.existing_pick %}
          <span class="badge bg-success ms-2">Picked: {{ item.existing_pick.team_name }}</span>
        {% else %}
          <span class="badge bg-warning text-dark ms-2">No pick made yet</span>
        {% endif %}

        <a href="{% url 'lms_game_detail' item.entry.game.id %}" class="btn btn-sm btn-outline-secondary float-end">View Game</a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>You have not joined any LMS games yet.</p>
{% endif %}

<hr>

<!-- Joinable Games -->
<h3>Games Available to Join</h3>

{% if joinable_games %}
  <ul class="list-group">
{% for item in joinable_games %}
  <tr>
    <td>{{ item.game.get_league_display }}</td>
    <td>Round 1 starts: {{ item.round1.start_date|date:"M d, Y" }}</td>
    <td>
      <a href="{% url 'lms_pick' item.game.id item.round1.id %}" class="btn btn-sm btn-outline-primary">
    Join
  </a>
</td>
  </tr>
{% endfor %}
  </ul>
{% else %}
  <p>No LMS games are currently open for joining.</p>
{% endif %}

{% endblock %}

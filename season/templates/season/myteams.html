{% extends "base.html" %}
{% load static %}
{% load dict_extras %}

{% block content %}

{% include "season/_season_header.html" %}

<h5 class="mt-4">My Teams</h5>
{% if picks_data %}
<!-- Responsive Table -->
<!-- <div class="table-responsive">
    <table class="table small-font table-sm table-striped table-hover table-bordered align-middle text-center">
        <thead class="table-dark">
            <tr class="table-primary"> -->
<div class="table-responsive">
    <table id="picks-table" class="table small-font table-sm table-striped table-hover table-bordered align-middle text-center">
        <thead class="table-dark">
            <tr class="table-primary">
                <th>Team</th>
                <th>League</th>
                <th>Pick Type</th>
                <th>Pos</th>
                <th>Pl</th>
                <th>W</th>
                <th>D</th>
                <th>L</th>
                <th>Points</th>
                <th>Handicap</th>
                <th>Payouts</th>
                <th>League Rank</th>
            </tr>
        </thead>
        <tbody>
            {% for p in picks_data %}
            <tr>
                <td>{{ p.team.name }}</td>
                <td>{{ p.league }}</td>
                <td>{{ p.pick_type|title }}</td>
                <td>{{ p.position|default:"-" }}</td>
                <td>{{ p.played }}</td>
                <td>{{ p.won }}</td>
                <td>{{ p.drawn }}</td>
                <td>{{ p.lost }}</td>
                <td>{{ p.our_points|floatformat:2 }}</td>
                <td>{{ p.handicap }}</td>
                <td>£{{ p.payouts }}</td>
                <td>{{ p.league_rank|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<p>No picks available yet.</p>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('picks-table');
    const headers = table.querySelectorAll('th');
    const tbody = table.querySelector('tbody');

    headers.forEach((header, index) => {
        header.style.cursor = 'pointer';

        // Add an icon container span
        const icon = document.createElement('span');
        icon.className = 'ms-1 sort-indicator';
        header.appendChild(icon);

        header.addEventListener('click', () => {
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const isAsc = !header.classList.contains('asc');

            // Reset all headers
            headers.forEach(h => {
                h.classList.remove('asc', 'desc', 'table-info');
                h.querySelector('.sort-indicator').textContent = '';
            });

            // Mark active header
            header.classList.add(isAsc ? 'asc' : 'desc', 'table-info');
            icon.textContent = isAsc ? '▲' : '▼';

            rows.sort((a, b) => {
                const aText = a.children[index].textContent.trim();
                const bText = b.children[index].textContent.trim();

                const aNum = parseFloat(aText.replace(/[^\d.-]/g, ''));
                const bNum = parseFloat(bText.replace(/[^\d.-]/g, ''));
                const bothNumbers = !isNaN(aNum) && !isNaN(bNum);

                if (bothNumbers) {
                    return isAsc ? aNum - bNum : bNum - aNum;
                } else {
                    return isAsc
                        ? aText.localeCompare(bText)
                        : bText.localeCompare(aText);
                }
            });

            rows.forEach(row => tbody.appendChild(row));
        });
    });
});
</script>

{% endblock content %}
